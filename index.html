<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Happy Birthday Nannu</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <style>
    html,body{margin:0;height:100%;overflow:hidden;background:#081b3e;}
    #wrap{position:relative;width:100vw;height:100vh;}
    canvas{display:block;width:100vw;height:100vh;}
    #err{position:fixed;left:0;right:0;top:0;background:#ff3860;color:#fff;
         font:14px/1.4 system-ui,Arial;padding:10px;display:none;z-index:9}
    #clock-box{position:absolute;top:2.2vh;left:5vw;color:#fff;z-index:3;
               font:600 18px system-ui,Arial}
    #text{position:absolute;top:15vh;left:5vw;width:78vw;max-width:560px;color:#fff;z-index:3}
    #code{display:none;line-height:1.35;font:14px system-ui,Arial}
    @media (max-width:420px){#clock-box{font-size:16px} #text{top:17vh;font-size:13px}}
  </style>
  <link rel="stylesheet" href="file/default.css">
</head>
<body>
  <div id="err"></div>
  <audio id="myAudio"><source src="aud.mp3" type="audio/mpeg"></audio>

  <div id="wrap">
    <div id="clock-box"><span id="clock">Loadingâ€¦</span></div>
    <div id="text"><div id="code">
      <span class="say">Nanuu ðŸ¥ºðŸ¥ºðŸ¥º Mere Bachee Mere ZuvuuðŸ’ž</span><br>
      <span class="say">Happy Birthday Very Very Happy Birthday JaanðŸŽˆ</span><br>
      <span class="say">Aap hamesha khush raho. I miss you.</span><br>
      <span class="say">May Allah bless you with happiness. ðŸ’•</span><br>
      <span class="say">My world, my universe, my everything.</span><br>
      <span class="say">Apna khayaal rakha karo, Nannuuu ðŸ¥º</span><br>
      <span class="say">Happy Birthday once again!</span><br>
    </div></div>
    <canvas id="canvas"></canvas>
  </div>

  <script>
    // Show first error to debug missing files
    (function(){
      const box=document.getElementById('err');
      window.addEventListener('error',e=>{
        box.style.display='block';
        box.textContent = e && e.message ? e.message : 'A script failed to load';
      });
    })();

    // Ensure canvas matches screen
    const cv=document.getElementById('canvas');
    function size(){ cv.width=innerWidth; cv.height=innerHeight; }
    size(); addEventListener('resize',size); addEventListener('orientationchange',size);

    // Play audio on first user interaction (mobile policy)
    (function(){
      const a=document.getElementById('myAudio');
      const kick=()=>{ a.play().catch(()=>{}); removeEventListener('click',kick); removeEventListener('touchstart',kick); };
      addEventListener('click',kick,{passive:true});
      addEventListener('touchstart',kick,{passive:true});
    })();

    // Load required libraries in order; paths must match file/ folder exactly.
    const libs=[
      'file/jquery.min.js',
      'file/jscex.min.js',
      'file/jscex-parser.js',
      'file/jscex-jit.js',
      'file/jscex-builderbase.min.js',
      'file/jscex-async.min.js',
      'file/jscex-async-powerpack.min.js',
      'file/functions.js',
      'file/love.js'
    ];
    function loadScript(src){ return new Promise((res,rej)=>{ const s=document.createElement('script'); s.src=src; s.onload=res; s.onerror=()=>rej(new Error('Failed to load '+src)); document.body.appendChild(s); }); }

    (async function main(){
      try{ for(const l of libs){ await loadScript(l); } }
      catch(err){ const box=document.getElementById('err'); box.style.display='block'; box.textContent=err.message; return; }

      // Countdown to next birthday (set month/day)
      (function clockCounter(){
        const span=document.getElementById('clock');
        function nextBirthday(m,d){ const n=new Date(); let y=n.getFullYear(); let t=new Date(y,m-1,d,0,0,0); if(t<n) t=new Date(y+1,m-1,d,0,0,0); return t; }
        const target=nextBirthday(9,30); // change here
        function tick(){
          const n=new Date(); let diff=Math.max(0,target-n);
          const d=Math.floor(diff/86400000); diff%=86400000;
          const h=Math.floor(diff/3600000); diff%=3600000;
          const m=Math.floor(diff/60000); diff%=60000;
          const s=Math.floor(diff/1000);
          span.textContent=`${d} days ${h} hours ${m} minutes ${s} seconds`;
          setTimeout(tick,500);
        } tick();
      })();

      // Run tree animation
      const $=window.jQuery; const $canvas=$(cv); const width=$canvas.width(); const height=$canvas.height();
      const opts={
        seed:{x:width/2-20,color:'rgb(190,26,37)',scale:2},
        branch:[[535,680,570,250,500,200,30,100,[
          [540,500,455,417,340,400,13,100,[[450,435,434,430,394,395,2,40]]],
          [550,445,600,356,680,345,12,100,[[578,400,648,409,661,426,3,80]]],
          [539,281,537,248,534,217,3,40],
          [546,397,413,247,328,244,9,80,[
            [427,286,383,253,371,205,2,40],
            [498,345,435,315,395,330,4,60]
          ]],
          [546,357,608,252,678,221,6,100,[[590,293,646,277,648,271,2,80]]]
        ]]] ,
        bloom:{num:700,width:width,height:height-30},
        footer:{width:width,height:5,speed:10}
      };
      const tree=new Tree(cv,width,height,opts);
      const seed=tree.seed, foot=tree.footer;

      const seedAnimate=eval(Jscex.compile('async', function () {
        seed.draw();
        while (seed.canScale()) { seed.scale(0.95); $await(Jscex.Async.sleep(10)); }
        while (seed.canMove()) { seed.move(0,2); foot.draw(); $await(Jscex.Async.sleep(10)); }
      }));
      const growAnimate=eval(Jscex.compile('async', function(){ do{ tree.grow(); $await(Jscex.Async.sleep(10)); } while(tree.canGrow()); }));
      const flowAnimate=eval(Jscex.compile('async', function(){ do{ tree.flower(2); $await(Jscex.Async.sleep(10)); } while(tree.canFlower()); }));
      const moveAnimate=eval(Jscex.compile('async', function(){
        tree.snapshot('p1',240,0,Math.min(610,width-240),height);
        while(tree.move('p1',Math.min(500,width-500),0)){ foot.draw(); $await(Jscex.Async.sleep(10)); }
        foot.draw();
        tree.snapshot('p2',Math.min(500,width-500),0,Math.min(610,width-240),height);
        $canvas.parent().css('background','url('+tree.toDataURL('image/png')+')');
        $canvas.css('background','#ffe'); $await(Jscex.Async.sleep(300)); $canvas.css('background','none');
      }));
      const textAnimate=eval(Jscex.compile('async', function(){ $('#code').show().typewriter(); }));
      const runAsync=eval(Jscex.compile('async', function(){ $await(seedAnimate()); $await(growAnimate()); $await(flowAnimate()); $await(moveAnimate()); textAnimate().start(); }));
      runAsync().start();
    })();
  </script>
</body>
</html>
